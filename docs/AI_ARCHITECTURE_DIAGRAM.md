# AI System - Architecture Diagram

Vizuelni prikaz arhitekture AI sistema.

---

## ğŸ—ï¸ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (Next.js)                          â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Chat Interfaceâ”‚  â”‚ Zustand Storeâ”‚  â”‚ React Components       â”‚ â”‚
â”‚  â”‚  - Messages   â”‚  â”‚  - Sessions  â”‚  â”‚  - ChatInput           â”‚ â”‚
â”‚  â”‚  - Streaming  â”‚  â”‚  - Commands  â”‚  â”‚  - ChatMessages        â”‚ â”‚
â”‚  â”‚  - History    â”‚  â”‚  - State     â”‚  â”‚  - SuggestedPrompts    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ POST /api/v1/chat (streaming)
          â”‚ Authorization: Bearer <token>
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API SERVER (Bun + Hono)                        â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     Chat Endpoint                             â”‚ â”‚
â”‚  â”‚  1. Authenticate user                                        â”‚ â”‚
â”‚  â”‚  2. Build user context                                       â”‚ â”‚
â”‚  â”‚  3. Load chat history (Redis)                                â”‚ â”‚
â”‚  â”‚  4. Route to agent                                           â”‚ â”‚
â”‚  â”‚  5. Stream response                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                         â”‚
â”‚                          â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  MAIN TRIAGE AGENT                           â”‚ â”‚
â”‚  â”‚                   (GPT-4o-mini)                              â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  Analyze message â†’ Determine intent â†’ Route to specialist    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                         â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚         â”‚                â”‚                â”‚             â”‚        â”‚
â”‚         â–¼                â–¼                â–¼             â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ General  â”‚  â”‚   Invoices   â”‚  â”‚ Customers â”‚  â”‚   Sales    â”‚ â”‚
â”‚  â”‚  Agent   â”‚  â”‚    Agent     â”‚  â”‚   Agent   â”‚  â”‚   Agent    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚                â”‚                 â”‚              â”‚        â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                          â”‚                                         â”‚
â”‚                          â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        AI TOOLS                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  Invoices   â”‚ â”‚  Customers   â”‚ â”‚  Products & Quotes â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  - Get      â”‚ â”‚  - Search    â”‚ â”‚  - List Products   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  - Overdue  â”‚ â”‚  - Details   â”‚ â”‚  - Categories      â”‚   â”‚ â”‚
â”‚  â”‚  â”‚             â”‚ â”‚  - Industriesâ”‚ â”‚  - Get Quotes      â”‚   â”‚ â”‚
â”‚  â”‚  â”‚             â”‚ â”‚              â”‚ â”‚  - Conversion      â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚            â”‚                â”‚                   â”‚                 â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                          â”‚                                         â”‚
â”‚                          â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     DATA LAYER                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  PostgreSQL  â”‚  â”‚    Redis     â”‚  â”‚  File Storage    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Invoices  â”‚  â”‚  - History   â”‚  â”‚  - Documents     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Customers â”‚  â”‚  - Memory    â”‚  â”‚  - Uploads       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - Products  â”‚  â”‚  - Cache     â”‚  â”‚  - PDFs          â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Request Flow

### Chat Message Flow

```
1. User Types Message
   â”‚
   â–¼
2. ChatInput Component
   â”‚ onChange
   â–¼
3. Zustand Store
   â”‚ handleSubmit
   â–¼
4. useChat Hook (Vercel AI SDK)
   â”‚ POST request
   â–¼
5. API Endpoint (/api/v1/chat)
   â”‚ JWT verification
   â”‚ Build context
   â–¼
6. Main Triage Agent
   â”‚ Analyze intent
   â”‚ Route decision
   â–¼
7. Specialized Agent
   â”‚ Load history
   â”‚ Call tools
   â–¼
8. Tools Execution
   â”‚ Database queries
   â”‚ Data formatting
   â–¼
9. Response Generation
   â”‚ Markdown formatting
   â”‚ Streaming
   â–¼
10. Frontend Update
    â”‚ Message added
    â”‚ UI re-render
```

**Typical Response Time**: 800ms - 3s

---

## ğŸ”Œ Document Processing Flow

```
1. User Uploads File
   â”‚
   â–¼
2. Upload to Storage
   â”‚ (Vercel Blob / S3 / Local)
   â–¼
3. Document Classifier
   â”‚ Mistral AI
   â”‚ PDF â†’ { type, confidence, language }
   â–¼
4. Type Router
   â”œâ”€ invoice â†’ Invoice Processor
   â”œâ”€ receipt â†’ Receipt Processor
   â””â”€ other â†’ Manual handling
   â”‚
   â–¼
5. Data Extraction
   â”‚ Mistral AI (vision/text)
   â”‚ Structured data extraction
   â”‚
   â–¼ (if poor quality)
6. OCR Fallback
   â”‚ unpdf text extraction
   â”‚ LLM on extracted text
   â”‚ Merge results
   â”‚
   â–¼
7. Validation
   â”‚ Zod schema validation
   â”‚ Critical fields check
   â”‚
   â–¼
8. Return Structured Data
   â”‚ { vendorName, amount, items, ... }
   â”‚
   â–¼
9. User Review & Confirm
   â”‚
   â–¼
10. Create Invoice Record
```

**Processing Time**: 3-10s depending on PDF complexity

---

## ğŸ¯ Category Embeddings Flow

```
1. Transaction Created
   â”‚ description: "Office chair"
   â–¼
2. Generate Embedding
   â”‚ Google Gemini API
   â”‚ text â†’ [0.234, -0.567, ..., 0.123] (768-dim vector)
   â”‚
   â–¼
3. Load Category Embeddings
   â”‚ From cache or generate
   â”‚ 20 categories â†’ 20 vectors
   â”‚
   â–¼
4. Calculate Similarity
   â”‚ Cosine similarity
   â”‚ Compare transaction vs all categories
   â”‚
   â–¼
5. Find Best Match
   â”‚ "Office Supplies": 0.89 âœ“ Best
   â”‚ "Equipment": 0.71
   â”‚ "Software": 0.45
   â”‚
   â–¼
6. Auto-categorize (if confidence > 0.7)
   â”‚ Update transaction.category_id
   â”‚ Set auto_categorized = true
   â”‚
   â–¼
7. User Can Override
   â”‚ Manual correction
   â”‚ Feedback for improvement
```

**Processing Time**: 300-800ms per transaction

---

## ğŸ—„ï¸ Data Model

### Chat Data

```
Redis Keys:
â”œâ”€ chat:history:{chatId}        # List of messages
â”œâ”€ chat:memory:{userId}         # Working memory
â””â”€ ratelimit:{userId}           # Rate limiting

Structure:
{
  "chat:history:uuid": [
    { role: "user", content: "...", timestamp: "..." },
    { role: "assistant", content: "...", timestamp: "..." }
  ],
  "chat:memory:user-123": "User prefers detailed reports...",
  "ratelimit:user-123": 45
}
```

### Document Data

```sql
-- documents table
CREATE TABLE documents (
  id UUID PRIMARY KEY,
  url TEXT NOT NULL,
  type TEXT,                    -- invoice, receipt, contract, other
  processed BOOLEAN DEFAULT FALSE,
  extracted_data JSONB,         -- Extracted structured data
  processing_error TEXT,
  processed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

-- document_corrections (for ML improvement)
CREATE TABLE document_corrections (
  id UUID PRIMARY KEY,
  document_url TEXT,
  extracted_data JSONB,
  corrected_data JSONB,
  user_id UUID,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### AI Metrics

```sql
-- ai_metrics table
CREATE TABLE ai_metrics (
  id UUID PRIMARY KEY,
  endpoint TEXT,           -- /api/v1/chat
  agent TEXT,              -- invoices, customers, etc.
  model TEXT,              -- gpt-4o-mini
  tokens_used INTEGER,
  duration INTEGER,        -- milliseconds
  success BOOLEAN,
  error TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- ai_audit_log table
CREATE TABLE ai_audit_log (
  id UUID PRIMARY KEY,
  user_id UUID,
  chat_id UUID,
  message TEXT,
  agent TEXT,
  tools_used JSONB,
  created_at TIMESTAMP DEFAULT NOW()
);
```

---

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Security Layers               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  1. Network Layer                       â”‚
â”‚     â”œâ”€ HTTPS/TLS                        â”‚
â”‚     â”œâ”€ CORS policies                    â”‚
â”‚     â””â”€ Rate limiting (nginx)            â”‚
â”‚                                         â”‚
â”‚  2. Authentication                      â”‚
â”‚     â”œâ”€ JWT validation                   â”‚
â”‚     â”œâ”€ Token expiration                 â”‚
â”‚     â””â”€ Refresh tokens                   â”‚
â”‚                                         â”‚
â”‚  3. Authorization                       â”‚
â”‚     â”œâ”€ User permissions                 â”‚
â”‚     â”œâ”€ Team scope isolation             â”‚
â”‚     â””â”€ API key scopes                   â”‚
â”‚                                         â”‚
â”‚  4. Input Validation                    â”‚
â”‚     â”œâ”€ Zod schemas                      â”‚
â”‚     â”œâ”€ SQL injection prevention         â”‚
â”‚     â””â”€ XSS protection                   â”‚
â”‚                                         â”‚
â”‚  5. API Layer                           â”‚
â”‚     â”œâ”€ Rate limiting (Redis)            â”‚
â”‚     â”œâ”€ Request size limits              â”‚
â”‚     â””â”€ Timeout limits                   â”‚
â”‚                                         â”‚
â”‚  6. Data Layer                          â”‚
â”‚     â”œâ”€ Encrypted connections            â”‚
â”‚     â”œâ”€ Row-level security               â”‚
â”‚     â””â”€ Audit logging                    â”‚
â”‚                                         â”‚
â”‚  7. AI Provider Layer                   â”‚
â”‚     â”œâ”€ API key rotation                 â”‚
â”‚     â”œâ”€ Usage monitoring                 â”‚
â”‚     â””â”€ Cost controls                    â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ Deployment Architecture

### Development

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser    â”‚â”€â”€â”€â”€â–¶â”‚  Next.js Dev â”‚â”€â”€â”€â”€â–¶â”‚  API Server  â”‚
â”‚  localhost   â”‚     â”‚  :3000       â”‚     â”‚  :3001       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚              â”‚              â”‚
                                    â–¼              â–¼              â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚PostgreSQLâ”‚  â”‚  Redis   â”‚  â”‚ OpenAI   â”‚
                              â”‚  :5432   â”‚  â”‚  :6379   â”‚  â”‚   API    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Production

```
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚  Cloudflare    â”‚
                                 â”‚  DNS + CDN     â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚    Load Balancer        â”‚
                            â”‚    (nginx/HAProxy)      â”‚
                            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                 â”‚              â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                                            â”‚
                  â–¼                                            â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Frontend Pod   â”‚                          â”‚   API Pod 1     â”‚
         â”‚  (Next.js)      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   (Bun)         â”‚
         â”‚  :3000          â”‚          â”‚               â”‚   :3001         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚                        â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Frontend Pod   â”‚          â”‚               â”‚   API Pod 2     â”‚
         â”‚  (Next.js)      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚   (Bun)         â”‚
         â”‚  :3000          â”‚          â”‚               â”‚   :3001         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚                        â”‚
                                      â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚               â”‚   API Pod 3     â”‚
                                      â”‚               â”‚   (Bun)         â”‚
                                      â”‚               â”‚   :3001         â”‚
                                      â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚                        â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚           â”‚            â”‚                         â”‚
          â–¼           â–¼            â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚PostgreSQLâ”‚ â”‚  Redis  â”‚ â”‚   OpenAI     â”‚      â”‚  Mistral AI  â”‚
    â”‚ Primary  â”‚ â”‚ Cluster â”‚ â”‚     API      â”‚      â”‚     API      â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚PostgreSQLâ”‚
    â”‚ Replica  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Component Interaction

### Agent â†’ Tool â†’ Database

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Invoice Agent  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ calls
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  getInvoicesTool        â”‚
â”‚  {                      â”‚
â”‚    pageSize: 10,        â”‚
â”‚    status: "overdue"    â”‚
â”‚  }                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ queries
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  invoiceQueries.findAll()       â”‚
â”‚  SELECT * FROM invoices         â”‚
â”‚  WHERE status = 'overdue'       â”‚
â”‚  LIMIT 10                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ returns
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Raw Data                       â”‚
â”‚  [ { id, invoiceNumber, ... } ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ formats
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Formatted Response                  â”‚
â”‚  | Invoice # | Status | Amount |... â”‚
â”‚  |-----------|--------|--------|     â”‚
â”‚  | INV-001   | ...    | ...    |     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ returns
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Invoice Agent  â”‚
â”‚  (adds context) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ streams
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Frontend     â”‚
â”‚  (displays)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© Package Dependencies

```
crm-monorepo/
â”‚
â”œâ”€ apps/
â”‚  â”œâ”€ api-server/
â”‚  â”‚  â””â”€ dependencies:
â”‚  â”‚     â”œâ”€ ai                    (Vercel AI SDK)
â”‚  â”‚     â”œâ”€ @ai-sdk/openai
â”‚  â”‚     â”œâ”€ @ai-sdk/mistral
â”‚  â”‚     â”œâ”€ @ai-sdk/google
â”‚  â”‚     â”œâ”€ @crm/documents    â”€â”
â”‚  â”‚     â””â”€ @crm/categories   â”€â”¤
â”‚  â”‚                            â”‚
â”‚  â””â”€ web/                      â”‚
â”‚     â””â”€ dependencies:          â”‚
â”‚        â”œâ”€ ai (React hooks)    â”‚
â”‚        â”œâ”€ @ai-sdk/react       â”‚
â”‚        â””â”€ zustand             â”‚
â”‚                               â”‚
â””â”€ packages/                    â”‚
   â”œâ”€ documents/ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚  â””â”€ dependencies:
   â”‚     â”œâ”€ @ai-sdk/mistral
   â”‚     â”œâ”€ ai
   â”‚     â”œâ”€ unpdf
   â”‚     â””â”€ zod
   â”‚
   â””â”€ categories/ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â””â”€ dependencies:            â”‚
         â”œâ”€ @ai-sdk/google        â”‚
         â””â”€ ai                    â”‚
                                  â”‚
         Used by: api-server â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Memory Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MEMORY LAYERS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Layer 1: Short-term (Request Context)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ Current message                                     â”‚ â”‚
â”‚  â”‚  â€¢ User input                                          â”‚ â”‚
â”‚  â”‚  â€¢ Immediate context                                   â”‚ â”‚
â”‚  â”‚  Lifetime: Single request                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  Layer 2: Session (Chat History)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ Last 20 messages                                    â”‚ â”‚
â”‚  â”‚  â€¢ Tool calls & results                                â”‚ â”‚
â”‚  â”‚  â€¢ Conversation flow                                   â”‚ â”‚
â”‚  â”‚  Storage: Redis                                        â”‚ â”‚
â”‚  â”‚  Lifetime: 7 days                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  Layer 3: Working Memory (User Context)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ User preferences                                    â”‚ â”‚
â”‚  â”‚  â€¢ Recent topics                                       â”‚ â”‚
â”‚  â”‚  â€¢ Important context                                   â”‚ â”‚
â”‚  â”‚  Storage: Redis                                        â”‚ â”‚
â”‚  â”‚  Lifetime: 7 days                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  Layer 4: Long-term (Database)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ All historical data                                 â”‚ â”‚
â”‚  â”‚  â€¢ Invoices, customers, products                       â”‚ â”‚
â”‚  â”‚  â€¢ Audit logs                                          â”‚ â”‚
â”‚  â”‚  Storage: PostgreSQL                                   â”‚ â”‚
â”‚  â”‚  Lifetime: Permanent                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ Multi-Region Setup (Future)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Global    â”‚
                    â”‚     CDN     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                â”‚                â”‚
          â–¼                â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Region  â”‚    â”‚  Region  â”‚    â”‚  Region  â”‚
    â”‚    EU    â”‚    â”‚    US    â”‚    â”‚   Asia   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚  Redis  â”‚     â”‚  Redis  â”‚     â”‚  Redis  â”‚
    â”‚ Cluster â”‚     â”‚ Cluster â”‚     â”‚ Cluster â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   PostgreSQL    â”‚
                â”‚ Primary (Global)â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± Client-Side Architecture

```
React Component Tree:

ChatInterface
â”œâ”€ ChatHeader
â”‚  â”œâ”€ NewChatButton
â”‚  â””â”€ HistoryDropdown
â”‚
â”œâ”€ ChatMessages
â”‚  â””â”€ MessageBubble (mapped)
â”‚     â”œâ”€ UserMessage
â”‚     â””â”€ AssistantMessage
â”‚        â””â”€ ReactMarkdown
â”‚           â”œâ”€ Table
â”‚           â”œâ”€ Link
â”‚           â””â”€ Code
â”‚
â”œâ”€ SuggestedPrompts
â”‚  â””â”€ PromptButton (mapped)
â”‚
â””â”€ ChatInput
   â”œâ”€ Textarea (auto-resize)
   â”œâ”€ SendButton
   â””â”€ StopButton

State Management (Zustand):

useChatStore
â”œâ”€ currentChatId
â”œâ”€ input
â”œâ”€ isLoading
â”œâ”€ sessions[]
â”œâ”€ commandSuggestions[]
â””â”€ actions
   â”œâ”€ createSession()
   â”œâ”€ deleteSession()
   â”œâ”€ handleInputChange()
   â””â”€ handleCommandSelect()
```

---

## ğŸ”„ CI/CD Pipeline

```
Git Push
   â”‚
   â–¼
GitHub Actions
   â”œâ”€ Lint (biome)
   â”œâ”€ Type check (tsc)
   â”œâ”€ Unit tests (vitest)
   â””â”€ Build
   â”‚
   â–¼
Conditional Deployment
   â”œâ”€ Development â†’ Auto-deploy
   â”œâ”€ Staging â†’ On PR merge
   â””â”€ Production â†’ Manual approval
   â”‚
   â–¼
Health Checks
   â”œâ”€ /health
   â”œâ”€ /health/ai
   â””â”€ Integration tests
   â”‚
   â–¼
Monitoring
   â”œâ”€ Sentry (errors)
   â”œâ”€ Grafana (metrics)
   â””â”€ Logs (Loki)
```

---

## ğŸ“ˆ Scaling Strategy

### Horizontal Scaling

```
1 Pod â†’ 3 Pods â†’ 10 Pods â†’ 50 Pods

Triggers:
- CPU > 70%
- Memory > 80%
- Request rate > 100/s
- Response time > 3s

Bottlenecks:
- Redis: Use cluster mode
- Database: Read replicas
- AI APIs: Multiple keys, load balance
```

### Vertical Scaling

```
Resources per pod:

Small (Development):
- CPU: 500m
- Memory: 512Mi
- Max requests: 10/s

Medium (Staging):
- CPU: 1000m
- Memory: 1Gi
- Max requests: 30/s

Large (Production):
- CPU: 2000m
- Memory: 2Gi
- Max requests: 100/s
```

---

**Last Updated**: 2024-12-02  
**Version**: 1.0.0
